/*!
 * PushStateTree - v0.15.0 - 2016-03-31
 *  https://github.com/gartz/pushStateTree/
 *  Copyright (c) 2016 Gabriel Reitz Giannattasio <gabriel@gartz.com.br>; Licensed MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PushStateTree=e():t.PushStateTree=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){(function(e){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){return!isNaN(parseFloat(t))&&t%1===0&&isFinite(t)}function o(t,e,n){(0,l["default"])(t,e,{get:function(){return n},set:function(){}})}function a(t){return/^[a-z0-9]+:\/\//i.test(t)}function s(t){return/^[^#\/]/.test(t)}function c(t){for(var e=t.split("/"),n=1;n<e.length;)".."===e[n]&&n>0&&".."!==e[n-1]&&(e.splice(n-1,2),n-=2),n++;return e.join("/").replace(/\/\.\/|\.\/|\.\.\//g,"/").replace(/^\/$/,"")}function u(t){function e(t){if("function"==typeof u.prototype[t])n[t]=function(){return u.prototype[t].apply(this,arguments)};else{if("undefined"!=typeof n[t])return;(0,l["default"])(n,t,{get:function(){return u.prototype[t]},set:function(e){u.prototype[t]=e}})}}if(t=t||{},t[b]=t[b]!==!1,!(this instanceof x))return u.apply(d.createElement("pushstatetree-route"),arguments);var n=this;this.VERSION="0.15.0";for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);if(u.prototype[m]){var i=t[b];(0,l["default"])(n,b,{get:function(){return i},set:function(t){i=t!==!1}})}else o(n,b,!1);Object.defineProperty(n,"beautifyLocation",{get:function(){return u.prototype.beautifyLocation&&i},set:function(t){u.prototype.beautifyLocation=t===!0}}),n.beautifyLocation=t.beautifyLocation&&n.usePushState;var a;Object.defineProperty(n,"basePath",{get:function(){return a},set:function(t){a=t||"","/"!==a[0]&&(a="/"+a)}}),n.basePath=t.basePath;for(var s in u.prototype)u.prototype.hasOwnProperty(s)&&e(s);o(n,"length",f.history.length),o(n,"state",f.history.state);var c={url:"",uri:""};Object.defineProperty(n,"uri",{get:function(){if(c.url===f.location.href)return c.uri;var t;if(f.location.hash.length||"#"===f.location.href[v.href.length-1]){t=f.location.hash.match(/^(#*)?(.*\/?)/)[2];var e=n[b];n.beautifyLocation&&n.isPathValid&&e&&n.replaceState(n.state,n.title,"/"===t[0]?t:"/"+t)}else t=f.location.pathname+f.location.search,this.isPathValid&&(t=t.slice(this.basePath.length));return t=t.replace(/^[\/]+/,""),n.getAttribute("uri")!==t&&n.setAttribute("uri",t),c.url=f.location.href,c.uri=t,t},configurable:!0}),Object.defineProperty(n,"isPathValid",{get:function(){var t=f.location.pathname+f.location.search;return!this.basePath||0===t.indexOf(this.basePath)}}),n.eventStack={leave:[],change:[],enter:[],match:[]},f.addEventListener(w,function(){var t=n.uri,e=n.state;n.rulesDispatcher(),I=t,j=e,D&&this.dispatch()}.bind(n));var h=!1,p=function(){if(!h&&I!==n.uri){var t=n.uri,e=n.state;n.rulesDispatcher(),I=t,j=e,D&&this.dispatch()}}.bind(n);n.avoidHashchangeHandler=function(){f.removeEventListener(_,p),h=!0},f.addEventListener(_,p);var E=function(){f.dispatchEvent(new g(_))};return d.addEventListener("DOMContentLoaded",E),f.addEventListener("readystatechange",E),f.addEventListener("load",function(){var t=this;E(),y&&f.setInterval(function(){return t.uri!==I?void E():void(h&&(h=!1,I=t.uri,f.addEventListener(_,p)))},50)}.bind(n)),this}function h(t){var e=t;this[t]=function(){var t=Array.prototype.slice.call(arguments);if(("pushState"===e||"replaceState"===e)&&!a(t[2])){if(s(t[2])){var n=this.uri.match(/^([^?#]*)\//);n=n?n[1]+"/":"",t[2]=n+t[2]}else t[2]=t[2].match(/^([#\/]*)?(.*)/)[2];this[b]?t[2]=this.basePath+t[2]:t[2]=v.pathname+"#"+c(t[2])}return f.history[e].apply(f.history,t),this}}var p=n(1),l=r(p),f="undefined"!=typeof window&&window||e,d=f.document,v=f.location,y=function(){var t=window.navigator.userAgent.indexOf("Trident");return t>=0}();!function(){f.location.origin||(f.location.origin=f.location.protocol+"//"+f.location.host)}(),function(){Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},i=function(){var i=t;return this instanceof r&&t&&(i=this),n.apply(i,e.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,i.prototype=new r,i})}();var g=f.HashChangeEvent,E=f.Event;!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=d.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}if(Element.prototype.addEventListener){t.prototype=E.prototype,f.CustomEvent&&!y||(f.CustomEvent=t),(!g||f.opera&&f.opera.version()<15||y)&&(g=f.CustomEvent),y&&(E=t);try{new g("hashchange")}catch(e){g=t}try{new E("popstate")}catch(e){E=t}}}(),function(){if(!Element.prototype.addEventListener&&l["default"]){var t=d.createEventObject().constructor.prototype;Object.defineProperty(t,"target",{get:function(){return this.srcElement}});var e=function(t,e){this.__bindedFunctions||(this.__bindedFunctions=[]);var n=e;if(!("on"+t in this)||"hashchange"===t){this.__elemetIEid=this.__elemetIEid||"__ie__"+Math.random();var r=t+this.__elemetIEid,i=this,o=function(t){t.propertyName===r&&n.call(i,d.documentElement[r])};if(this.__bindedFunctions.push({original:n,binded:o}),d.documentElement.attachEvent("onpropertychange",o),"hashchange"!==t)return}var a=n.bind(this);this.__bindedFunctions.push({original:n,binded:a}),this.attachEvent("on"+t,a)};HTMLDocument.prototype.addEventListener=e,Element.prototype.addEventListener=e,window.addEventListener=e;var n=function(t,e){this.__bindedFunctions||(this.__bindedFunctions=[]);var n,r=e;if(!("on"+t in this)||"hashchange"===t){for(var i=0;i<this.__bindedFunctions.length;i++)this.__bindedFunctions[i].original===r&&(n=this.__bindedFunctions[i].binded,this.__bindedFunctions=this.__bindedFunctions.splice(i,1),i=this.__bindedFunctions.length);if(n&&d.documentElement.detachEvent("onpropertychange",n),"hashchange"!==t)return}for(var o=0;o<this.__bindedFunctions.length;o++)this.__bindedFunctions[o].original===r&&(n=this.__bindedFunctions[o].binded,this.__bindedFunctions=this.__bindedFunctions.splice(o,1),o=this.__bindedFunctions.length);n&&this.detachEvent("on"+t,n)};HTMLDocument.prototype.removeEventListener=n,Element.prototype.removeEventListener=n,window.removeEventListener=n,E=function(t,e){var n=d.createEventObject();return e=e||{},n.type=t,n.detail=e.detail,"on"+t in f&&"hashchange"!==t||(n.name=t,n.customEvent=!0),n},CustomEvent=E,g=CustomEvent;var r=function(t){if(!t.customEvent)return void this.fireEvent(t.type,t);if(this.__elemetIEid){var e=t.name+this.__elemetIEid;d.documentElement[e]=t}};HTMLDocument.prototype.dispatchEvent=r,Element.prototype.dispatchEvent=r,window.dispatchEvent=r}}(),function(){var t="forEach"in Array.prototype;if(!t){var e=Array.prototype.slice;Array.prototype.slice=function(){for(var t=[],n=0,r=this.length;r>n;n++)n in this&&t.push(this[n]);return e.apply(t,arguments)}}"forEach"in Array.prototype||(Array.prototype.forEach=function(t,e){for(var n=0;n<this.length;n++)n in this&&t.call(e,this[n],n)}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.prototype.filter||(Array.prototype.filter=function(t){if(void 0===this||null===this)throw new TypeError;var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var r=[],i=arguments.length>=2?arguments[1]:void 0,o=0;n>o;o++)if(o in e){var a=e[o];t.call(i,a,o,e)&&r.push(a)}return r})}();var b="usePushState",m="hasPushState",_="hashchange",w="popstate",P="leave",S="update",L="enter",O="change",A="match",F="oldMatch",x="undefined"!=typeof HTMLElement?HTMLElement:Element,j=null,I=null,C=[],D=!1,H=!1;u.prototype={beautifyLocation:!0,createRule:function(t){var e=d.createElement("pushstatetree-rule"),n=new RegExp("");Object.defineProperty(e,"rule",{get:function(){return n},set:function(t){if(t instanceof RegExp)n=t;else{if(t===n.toString())return;var r=(t+"").match(/^\/(.+)\/([gmi]*)|(.*)/);n=new RegExp(r[1]||r[3],r[2])}e.setAttribute("rule",n.toString())}}),Object.defineProperty(e,"parentGroup",{get:function(){var t=e.getAttribute("parent-group");return t&&i(t)?+t:null},set:function(t){i(t)?e.setAttribute("parent-group",t):e.removeAttribute("parent-group")}});for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);var o=[];(0,l["default"])(e,A,{get:function(){return o},set:function(t){o=t instanceof Array?t:[]}});var a=[];return(0,l["default"])(e,F,{get:function(){return a},set:function(t){a=t instanceof Array?t:[]}}),e[A]=[],e[F]=[],["assign","navigate","replace","dispatch","pushState","replaceState"].forEach(function(t){e[t]=function(){this.parentElement[t].apply(this.parentElement,arguments)}}),e},add:function(t){return this.appendChild(this.createRule(t)),this},remove:function(t){var e=t;return"string"==typeof t&&(e=this.querySelector(t)),e&&e.parentElement?(e.parentElement.removeChild(e),e):void 0},dispatch:function(){return H?(D=!0,this):(D=!1,f.dispatchEvent(new E(w)),this)},assign:function(t){return this.pushState(null,null,t).dispatch()},replace:function(t){return this.replaceState(null,null,t).dispatch()},navigate:function(){this.assign.apply(this,arguments)},rulesDispatcher:function(){function t(t,n){return Array.prototype.slice.call(this.children||this.childNodes).forEach(e.bind(this,t,n)),t}function e(t,n,r){function i(t,e){e=e||{},e.detail=e.detail||{},e.detail[A]=c||[],e.detail[F]=u||[],e.cancelable=!0;var n=new f.CustomEvent(t,e);return n}if(r.rule){var o,a=t,s=n;"number"==typeof r.parentGroup&&(a="",o=r.parentElement,o[A].length>r.parentGroup&&(a=o[A][r.parentGroup]||""),s="",o[F].length>r.parentGroup&&(s=o[F][r.parentGroup]||"")),r[A]=a[A](r.rule),"string"==typeof s?r[F]=s[A](r.rule):r[F]=[];var c=r[A],u=r[F],h=Array.prototype.slice.call(r.children);if(0===c.length){if(0===u.length||r.routerURI!==n)return;return r.uri=null,r.removeAttribute("uri"),h.forEach(e.bind(this,t,n)),r.dispatchEvent(new i(S,{detail:{type:P}})),void r.dispatchEvent(new i(P))}this.eventStack[A].push({element:r,events:[new i(A)]});var p=r.routerURI!==n;if(r.routerURI=this.uri,r.uri=c[0],r.setAttribute("uri",c[0]),0===u.length||p)return this.eventStack[L].push({element:r,events:[new i(S,{detail:{type:L}}),new i(L)]}),void h.forEach(e.bind(this,t,n));c[0]!==u[0]&&this.eventStack[O].push({element:r,events:[new i(S,{detail:{type:O}}),new i(O)]}),h.forEach(e.bind(this,t,n))}}if(this.isPathValid&&(C.push(t.bind(this,this.uri)),!(C.length>1))){for(var n=I;C.length>0;)n=C[0].call(null,n),C.shift();H=!0;var r=this.eventStack;[O,L,A].forEach(function(t){for(;r[t].length>0;){for(var e=r[t][0].events,n=r[t][0].element;e.length>0;)n.dispatchEvent(e[0]),e.shift();r[t].shift()}}),H=!1}}};for(var T in f.history)"function"==typeof f.history[T]&&h.call(u.prototype,T);u.prototype[m]=f.history&&!!f.history.pushState,u.prototype[m]||(u.prototype[b]=!1);var M=null;u.prototype.pushState||(u.prototype.pushState=function(t,e,n){var r=d.title||"";return n=n||"",null!==M&&(d.title=M),this.avoidHashchangeHandler(),a(n)&&(f.location.href=n),"#"===n[0]&&(n=n.slice(1)),s(n)&&(n=f.location.hash.slice(1,f.location.hash.lastIndexOf("/")+1)+n,n=c(n)),f.location.hash=n,d.title=r,M=e,this}),u.prototype.replaceState||(u.prototype.replaceState=function(t,e,n){var r=d.title||"";if(n=n||"",null!==M&&(d.title=M),this.avoidHashchangeHandler(),a(n))throw new Error("Invalid url replace.");if("#"===n[0]&&(n=n.slice(1)),s(n)){var i=f.location.hash.lastIndexOf("/")+1;n=f.location.hash.slice(1,i)+n,n=c(n)}return n="#"+n,f.location.replace(n),d.title=r,M=e,this}),t.exports=u}).call(e,function(){return this}())},function(t,e,n){t.exports={"default":n(2),__esModule:!0}},function(t,e,n){var r=n(3);t.exports=function(t,e,n){return r.setDesc(t,e,n)}},function(t,e){var n=Object;t.exports={create:n.create,getProto:n.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:n.getOwnPropertyDescriptor,setDesc:n.defineProperty,setDescs:n.defineProperties,getKeys:n.keys,getNames:n.getOwnPropertyNames,getSymbols:n.getOwnPropertySymbols,each:[].forEach}}])});